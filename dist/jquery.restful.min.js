/*!
 * jQuery restful plugin v1.1.9
 * https://github.com/myspace-nu
 *
 * Copyright 2018 Johan Johansson
 * Released under the MIT license
 */

!function(h){h.fn.serializeObject=function(){var e={},t=this.serializeArray();return h.each(t,function(){e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""}),e},h.fn.restful=function(e){var c=h.extend({url:null,method:"POST",onComplete:function(){},onSuccess:function(){},onError:function(){},onBeforeRequest:function(){return!0},dataType:"json",headers:{},preventHammering:!0,defaultValue:null},e);return c.url&&(c.url=c.url.replace(/\/+$/,"")),this.each(function(){"form"==this.tagName.toLowerCase()?h(this).submit(function(e){if(e.preventDefault(),!c.onBeforeRequest.call(this,this))return console.warn("Input is invalid, aborting...");var t=h(e.target).find("input[type=submit]:focus,button:focus");c.preventHammering&&h(t).prop("disabled",!0);var n=h(this).serializeObject(),a=h(this).attr("action");a||console.warn("No URL found for "+this.tagName+"-element."),!a.match(/^(\w{3,5}\:)?\/+/)&&c.url&&(a=c.url+"/"+a.replace(/^\/+/,""));var r=a.match(/{+\:?\w+}+/g);for(var s in r){var i=r[s].match(/\w+/);a=a.replace(r[s],n[i[0]]||n[i[0].toLowerCase()]||c.defaultValue),delete n[i[0]]}var o={url:a,type:h(this).attr("method")||c.method,context:this,headers:c.headers,success:function(e){c.onSuccess.call(this,e)},error:function(e){c.onError.call(this,e)},complete:function(e){c.preventHammering&&h(t).prop("disabled",!1),c.onComplete.call(this,e)}},l=0,u=0;h(this).find('input[type="file"]').each(function(e){var t=h(this).get()[0].files;l+=t.length;var r=h(this).attr("name");n[r]=new Array,Array.prototype.forEach.call(t,function(a){var e=new FileReader;e.onload=function(e){var t=e.target.result.substring(0,e.target.result.indexOf(",")).match(/^\w+\:(.+?\/.+?);(\w+)/);n[r].push({filename:a.name,size:a.size,"content-type":t[1],encoding:t[2],data:e.target.result.substring(e.target.result.indexOf(",")+1)}),++u==l&&("json"==c.dataType.toLowerCase()?o.data=JSON.stringify(n):o.data=n,h.ajax(o))},e.readAsDataURL(a)})}),"get"==o.type.toLowerCase()?o.url+="?"+h.param(n):"json"==c.dataType.toLowerCase()?(o.contentType="application/json; charset=utf-8",o.dataType="json",o.data=JSON.stringify(n)):o.data=n,0==l&&h.ajax(o)}):h(this).click(function(e){if(e.preventDefault(),!c.onBeforeRequest.call(this,this))return console.warn("Input is invalid, aborting...");var t=this;if(c.preventHammering){if(h(t).hasClass("disabled"))return;h(t).addClass("disabled")}var a=h(this).data(),r=h(this).attr("href");r||console.warn("No URL found for "+t.tagName+"-element."),!r.match(/^(\w{3,5}\:)?\/+/)&&c.url&&(r=c.url+"/"+r.replace(/^\/+/,""));var n=r.match(/{+\:?\w+}+/g);for(var s in n){var i=n[s].match(/\w+/);r=r.replace(n[s],a[i[0]]||a[i[0].toLowerCase()]||c.defaultValue),delete a[i[0].toLowerCase()]}var o={url:r,type:c.method,context:this,headers:c.headers,success:function(e){c.onSuccess.call(this,e)},error:function(e){c.onError.call(this,e)},complete:function(e){c.preventHammering&&h(t).removeClass("disabled"),c.onComplete.call(this,e)}};"get"==o.type.toLowerCase()?o.url+="?"+h.param(a):"json"==c.dataType.toLowerCase()?(o.contentType="application/json; charset=utf-8",o.dataType="json",o.data=JSON.stringify(a)):o.data=a,h.ajax(o)})}),c}}(jQuery);