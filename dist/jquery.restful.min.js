/*!
 * jQuery restful plugin v1.1.12
 * https://github.com/myspace-nu
 *
 * Copyright 2018 Johan Johansson
 * Released under the MIT license
 */

!function(d){d.fn.serializeObject=function(){var e={},t=this.serializeArray();return d.each(t,function(){e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""}),e},d.fn.restful=function(e){var u=d.extend({url:null,method:"POST",encoding:"utf-8",onComplete:function(){},onSuccess:function(){},onError:function(){},onBeforeRequest:function(){return!0},dataType:"json",headers:{},preventHammering:!0,defaultValue:null},e);return u.url&&(u.url=u.url.replace(/\/+$/,"")),this.each(function(){"form"==this.tagName.toLowerCase()?d(this).submit(function(e){if(e.preventDefault(),!u.onBeforeRequest.call(this,this))return console.warn("Input is invalid, aborting...");var t=d(e.target).find("input[type=submit]:focus,button:focus");u.preventHammering&&d(t).prop("disabled",!0);var r=d(this).serializeObject();(i=d(this).attr("action"))||console.warn("No URL found for "+this.tagName+"-element.");var n,a=(i=!i.match(/^(\w{3,5}\:)?\/+/)&&u.url?u.url+"/"+i.replace(/^\/+/,""):i).match(/{+\:?\w+}+/g);for(n in a){var o=a[n].match(/\w+/),i=i.replace(a[n],r[o[0]]||r[o[0].toLowerCase()]||u.defaultValue);delete r[o[0]]}var s={url:i,type:d(this).attr("method")||u.method,context:this,headers:u.headers,success:function(e){u.onSuccess.call(this,e)},error:function(e){u.onError.call(this,e)},complete:function(e){u.preventHammering&&d(t).prop("disabled",!1),u.onComplete.call(this,e)}},c=0,l=0;d(this).find('input[type="file"]').each(function(e){var t=d(this).get()[0].files;c+=t.length;var a=d(this).attr("name");r[a]=new Array,Array.prototype.forEach.call(t,function(n){var e=new FileReader;e.onload=function(e){var t=e.target.result.substring(0,e.target.result.indexOf(",")).match(/^\w+\:(.+?\/.+?);(\w+)/);r[a].push({filename:n.name,size:n.size,"content-type":t[1],encoding:t[2],data:e.target.result.substring(e.target.result.indexOf(",")+1)}),++l==c&&("json"==u.dataType.toLowerCase()?s.data=JSON.stringify(r):s.data=r,d.ajax(s))},e.readAsDataURL(n)})}),"get"==s.type.toLowerCase()?s.url+="?"+d.param(r):"json"==u.dataType.toLowerCase()?(s.contentType="application/json"+(u.encoding?"; charset="+u.encoding:""),u.encoding&&"utf-8"!=u.encoding&&(s.beforeSend=function(e){e.overrideMimeType(s.contentType)}),s.dataType="json",s.data=JSON.stringify(r)):s.data=r,0==c&&d.ajax(s)}):d(this).click(function(e){if(e.preventDefault(),!u.onBeforeRequest.call(this,this))return console.warn("Input is invalid, aborting...");var t=this;if(u.preventHammering){if(d(t).hasClass("disabled"))return;d(t).addClass("disabled")}var n=d(this).data();(i=d(this).attr("href"))||console.warn("No URL found for "+t.tagName+"-element.");var a,r=(i=!i.match(/^(\w{3,5}\:)?\/+/)&&u.url?u.url+"/"+i.replace(/^\/+/,""):i).match(/{+\:?\w+}+/g);for(a in r){var o=r[a].match(/\w+/),i=i.replace(r[a],n[o[0]]||n[o[0].toLowerCase()]||u.defaultValue);delete n[o[0].toLowerCase()]}var s={url:i,type:u.method,context:this,headers:u.headers,success:function(e){u.onSuccess.call(this,e)},error:function(e){u.onError.call(this,e)},complete:function(e){u.preventHammering&&d(t).removeClass("disabled"),u.onComplete.call(this,e)}};"get"==s.type.toLowerCase()?s.url+="?"+d.param(n):"json"==u.dataType.toLowerCase()?(s.contentType="application/json"+(u.encoding?"; charset="+u.encoding:""),u.encoding&&"utf-8"!=u.encoding&&(s.beforeSend=function(e){e.overrideMimeType(s.contentType)}),s.dataType="json",s.data=JSON.stringify(n)):s.data=n,d.ajax(s)})}),u}}(jQuery);